<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gmail Signature Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            max-width: 800px;
            width: 100%;
            padding: 40px;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .auth-section {
            text-align: center;
            padding: 40px 0;
        }

        .btn {
            background: #4285f4;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn:hover {
            background: #357ae8;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .hidden {
            display: none;
        }

        .user-info {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .user-info p {
            margin: 5px 0;
            color: #333;
        }

        .signature-section {
            margin-top: 30px;
        }

        .signature-preview {
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
            background: #fafafa;
            min-height: 150px;
        }

        .signature-editor {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: inherit;
            font-size: 14px;
            margin-bottom: 20px;
        }

        .status-message {
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            display: none;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        .status-message.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
            display: block;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .signature-template {
            background: #e9ecef;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .signature-template h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .signature-template label {
            display: block;
            margin: 10px 0 5px;
            color: #555;
            font-weight: 500;
        }

        .signature-template input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
        }

        .signature-template input:focus {
            outline: none;
            border-color: #4285f4;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Gmail Signature Manager</h1>
        <p class="subtitle">Update your Gmail signature and set it as default for all emails</p>

        <div id="statusMessage" class="status-message"></div>

        <!-- Authentication Section -->
        <div id="authSection" class="auth-section">
            <p style="margin-bottom: 20px; color: #666;">Sign in with your Google account to manage your Gmail signature</p>
            <button id="authorizeButton" class="btn">
                <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
                    <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/>
                    <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/>
                    <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/>
                    <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/>
                    <path fill="none" d="M0 0h48v48H0z"/>
                </svg>
                Sign in with Google
            </button>
        </div>

        <!-- Main Application Section -->
        <div id="mainSection" class="hidden">
            <div class="user-info">
                <p><strong>Signed in as:</strong> <span id="userEmail"></span></p>
            </div>

            <div class="signature-template">
                <h3>Create Your Signature</h3>
                <label for="fullName">Full Name *</label>
                <input type="text" id="fullName" placeholder="John Doe" required>

                <label for="title">Job Title</label>
                <input type="text" id="title" placeholder="Software Engineer">

                <label for="phone">Phone</label>
                <input type="text" id="phone" placeholder="+1 (555) 123-4567">

                <label for="company">Company</label>
                <input type="text" id="company" placeholder="Acme Corp">

                <label for="website">Website</label>
                <input type="text" id="website" placeholder="https://example.com">

                <div style="margin-top: 15px;">
                    <button id="generateButton" class="btn">Generate Signature</button>
                </div>
            </div>

            <div class="signature-section">
                <h3 style="margin-bottom: 15px; color: #333;">Signature Preview</h3>
                <div id="signaturePreview" class="signature-preview">
                    <p style="color: #999; font-style: italic;">Your signature will appear here...</p>
                </div>

                <div class="button-group">
                    <button id="updateButton" class="btn" disabled>
                        <span id="updateButtonText">Update Gmail Signature</span>
                        <span id="updateButtonLoading" class="loading hidden"></span>
                    </button>
                    <button id="signOutButton" class="btn btn-secondary">Sign Out</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script>
        // Gmail API configuration
        const CLIENT_ID = 'YOUR_CLIENT_ID_HERE'; // Replace with your OAuth 2.0 Client ID
        const API_KEY = 'YOUR_API_KEY_HERE'; // Replace with your API Key
        const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/gmail/v1/rest';
        const SCOPES = 'https://www.googleapis.com/auth/gmail.settings.basic https://www.googleapis.com/auth/gmail.settings.sharing';

        let tokenClient;
        let accessToken = null;
        let userEmail = null;

        // Initialize Google Identity Services
        function initializeGoogleIdentity() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: SCOPES,
                callback: (response) => {
                    if (response.error !== undefined) {
                        showStatus('Authentication failed: ' + response.error, 'error');
                        return;
                    }
                    accessToken = response.access_token;
                    handleAuthSuccess();
                },
            });
        }

        // Handle successful authentication
        async function handleAuthSuccess() {
            try {
                // Get user profile
                const userInfo = await fetch('https://www.googleapis.com/oauth2/v2/userinfo', {
                    headers: {
                        'Authorization': 'Bearer ' + accessToken
                    }
                });
                const userData = await userInfo.json();
                userEmail = userData.email;

                // Update UI
                document.getElementById('authSection').classList.add('hidden');
                document.getElementById('mainSection').classList.remove('hidden');
                document.getElementById('userEmail').textContent = userEmail;
                
                showStatus('Successfully signed in! You can now create and update your signature.', 'info');
                
                // Load current signature
                await loadCurrentSignature();
            } catch (error) {
                showStatus('Error loading user info: ' + error.message, 'error');
            }
        }

        // Load current Gmail signature
        async function loadCurrentSignature() {
            try {
                const response = await fetch(
                    `https://gmail.googleapis.com/gmail/v1/users/me/settings/sendAs/${encodeURIComponent(userEmail)}`,
                    {
                        headers: {
                            'Authorization': 'Bearer ' + accessToken
                        }
                    }
                );

                if (response.ok) {
                    const data = await response.json();
                    if (data.signature) {
                        document.getElementById('signaturePreview').innerHTML = data.signature;
                        document.getElementById('updateButton').disabled = false;
                    }
                } else if (response.status === 401) {
                    // Token expired, need to re-authenticate
                    showStatus('Session expired. Please sign in again.', 'error');
                    handleSignOut();
                }
            } catch (error) {
                console.error('Error loading signature:', error);
                // Non-critical error, user can still create new signature
            }
        }

        // Generate signature from template
        function generateSignature() {
            const fullName = document.getElementById('fullName').value.trim();
            const title = document.getElementById('title').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const company = document.getElementById('company').value.trim();
            const website = document.getElementById('website').value.trim();

            if (!fullName) {
                showStatus('Please enter your full name', 'error');
                return;
            }

            let signatureHTML = `
                <div style="font-family: Arial, sans-serif; font-size: 14px; color: #333;">
                    <p style="margin: 0 0 5px 0;">
                        <strong style="font-size: 16px; color: #2c3e50;">${escapeHtml(fullName)}</strong>
                    </p>`;

            if (title) {
                signatureHTML += `
                    <p style="margin: 0 0 5px 0; color: #555;">
                        ${escapeHtml(title)}
                    </p>`;
            }

            if (company) {
                signatureHTML += `
                    <p style="margin: 0 0 10px 0; color: #555;">
                        ${escapeHtml(company)}
                    </p>`;
            }

            if (phone || website) {
                signatureHTML += `<div style="margin-top: 10px; padding-top: 10px; border-top: 2px solid #4285f4;">`;
                
                if (phone) {
                    signatureHTML += `
                        <p style="margin: 5px 0;">
                            <span style="color: #777;">üìû</span> ${escapeHtml(phone)}
                        </p>`;
                }

                if (website) {
                    const websiteUrl = website.startsWith('http') ? website : 'https://' + website;
                    signatureHTML += `
                        <p style="margin: 5px 0;">
                            <span style="color: #777;">üåê</span> <a href="${escapeHtml(websiteUrl)}" style="color: #4285f4; text-decoration: none;">${escapeHtml(website)}</a>
                        </p>`;
                }

                signatureHTML += `</div>`;
            }

            signatureHTML += `</div>`;

            document.getElementById('signaturePreview').innerHTML = signatureHTML;
            document.getElementById('updateButton').disabled = false;
            showStatus('Signature generated! Click "Update Gmail Signature" to save it.', 'success');
        }

        // Update Gmail signature
        async function updateGmailSignature() {
            if (!accessToken) {
                showStatus('Please sign in first', 'error');
                return;
            }

            const signatureHTML = document.getElementById('signaturePreview').innerHTML;
            if (!signatureHTML || signatureHTML.includes('Your signature will appear here')) {
                showStatus('Please generate a signature first', 'error');
                return;
            }

            // Show loading state
            document.getElementById('updateButton').disabled = true;
            document.getElementById('updateButtonText').textContent = 'Updating...';
            document.getElementById('updateButtonLoading').classList.remove('hidden');

            try {
                // Update the signature using Gmail API
                const response = await fetch(
                    `https://gmail.googleapis.com/gmail/v1/users/me/settings/sendAs/${encodeURIComponent(userEmail)}`,
                    {
                        method: 'PATCH',
                        headers: {
                            'Authorization': 'Bearer ' + accessToken,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            signature: signatureHTML,
                            isDefault: true
                        })
                    }
                );

                if (response.ok) {
                    showStatus('‚úì Signature updated successfully and set as default!', 'success');
                } else {
                    const error = await response.json();
                    throw new Error(error.error?.message || 'Failed to update signature');
                }
            } catch (error) {
                showStatus('Error updating signature: ' + error.message, 'error');
            } finally {
                // Reset button state
                document.getElementById('updateButton').disabled = false;
                document.getElementById('updateButtonText').textContent = 'Update Gmail Signature';
                document.getElementById('updateButtonLoading').classList.add('hidden');
            }
        }

        // Sign out
        function handleSignOut() {
            accessToken = null;
            userEmail = null;
            document.getElementById('authSection').classList.remove('hidden');
            document.getElementById('mainSection').classList.add('hidden');
            document.getElementById('signaturePreview').innerHTML = '<p style="color: #999; font-style: italic;">Your signature will appear here...</p>';
            document.getElementById('updateButton').disabled = true;
            
            // Clear form
            document.getElementById('fullName').value = '';
            document.getElementById('title').value = '';
            document.getElementById('phone').value = '';
            document.getElementById('company').value = '';
            document.getElementById('website').value = '';
            
            showStatus('Signed out successfully', 'info');
        }

        // Utility function to show status messages
        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.className = 'status-message ' + type;
            
            // Auto-hide success/info messages after 5 seconds
            if (type === 'success' || type === 'info') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 5000);
            }
        }

        // Escape HTML to prevent XSS
        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // Event listeners
        document.getElementById('authorizeButton').addEventListener('click', () => {
            if (CLIENT_ID === 'YOUR_CLIENT_ID_HERE') {
                showStatus('Please configure your Google OAuth Client ID in the code. See README for instructions.', 'error');
                return;
            }
            tokenClient.requestAccessToken({ prompt: '' });
        });

        document.getElementById('generateButton').addEventListener('click', generateSignature);
        document.getElementById('updateButton').addEventListener('click', updateGmailSignature);
        document.getElementById('signOutButton').addEventListener('click', handleSignOut);

        // Initialize on page load
        window.addEventListener('load', () => {
            initializeGoogleIdentity();
        });
    </script>
</body>
</html>
